import { c as createBase64WorkerFactory } from '../../../../rollup-plugin-web-worker-loader__helper__browser__createBase64WorkerFactory.js';

var WorkerFactory = createBase64WorkerFactory('Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKF90b0NvbnN1bWFibGVBcnJheSQxLCBfc2xpY2VkVG9BcnJheSkgewogICd1c2Ugc3RyaWN0JzsKCiAgZnVuY3Rpb24gX2ludGVyb3BEZWZhdWx0TGVnYWN5IChlKSB7IHJldHVybiBlICYmIHR5cGVvZiBlID09PSAnb2JqZWN0JyAmJiAnZGVmYXVsdCcgaW4gZSA/IGUgOiB7ICdkZWZhdWx0JzogZSB9OyB9CgogIHZhciBfdG9Db25zdW1hYmxlQXJyYXlfX2RlZmF1bHQgPSAvKiNfX1BVUkVfXyovX2ludGVyb3BEZWZhdWx0TGVnYWN5KF90b0NvbnN1bWFibGVBcnJheSQxKTsKICB2YXIgX3NsaWNlZFRvQXJyYXlfX2RlZmF1bHQgPSAvKiNfX1BVUkVfXyovX2ludGVyb3BEZWZhdWx0TGVnYWN5KF9zbGljZWRUb0FycmF5KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyQxID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsKCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrJDEoaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCiAgdmFyIFRpbnlFbWl0dGVyID0gZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gVGlueUVtaXR0ZXIoKSB7CiAgICAgIF9jbGFzc0NhbGxDaGVjayQxKHRoaXMsIFRpbnlFbWl0dGVyKTsKCiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnX19saXN0ZW5lcnMnLCB7CiAgICAgICAgdmFsdWU6IHt9LAogICAgICAgIGVudW1lcmFibGU6IGZhbHNlLAogICAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgICB9KTsKICAgIH0KCiAgICBfY3JlYXRlQ2xhc3MkMShUaW55RW1pdHRlciwgW3sKICAgICAga2V5OiAnZW1pdCcsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBlbWl0KGV2ZW50TmFtZSkgewogICAgICAgIGlmICghdGhpcy5fX2xpc3RlbmVyc1tldmVudE5hbWVdKSByZXR1cm4gdGhpczsKCiAgICAgICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBBcnJheShfbGVuID4gMSA/IF9sZW4gLSAxIDogMCksIF9rZXkgPSAxOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7CiAgICAgICAgICBhcmdzW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTsKICAgICAgICB9CgogICAgICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZTsKICAgICAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IgPSBmYWxzZTsKICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3IgPSB1bmRlZmluZWQ7CgogICAgICAgIHRyeSB7CiAgICAgICAgICBmb3IgKHZhciBfaXRlcmF0b3IgPSB0aGlzLl9fbGlzdGVuZXJzW2V2ZW50TmFtZV1bU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gKF9zdGVwID0gX2l0ZXJhdG9yLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlKSB7CiAgICAgICAgICAgIHZhciBoYW5kbGVyID0gX3N0ZXAudmFsdWU7CgogICAgICAgICAgICBoYW5kbGVyLmFwcGx5KHVuZGVmaW5lZCwgYXJncyk7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IHRydWU7CiAgICAgICAgICBfaXRlcmF0b3JFcnJvciA9IGVycjsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uICYmIF9pdGVyYXRvci5yZXR1cm4pIHsKICAgICAgICAgICAgICBfaXRlcmF0b3IucmV0dXJuKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcikgewogICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdvbmNlJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uY2UoZXZlbnROYW1lLCBoYW5kbGVyKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgdmFyIG9uY2UgPSBmdW5jdGlvbiBvbmNlKCkgewogICAgICAgICAgX3RoaXMub2ZmKGV2ZW50TmFtZSwgb25jZSk7CiAgICAgICAgICBoYW5kbGVyLmFwcGx5KHVuZGVmaW5lZCwgYXJndW1lbnRzKTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gdGhpcy5vbihldmVudE5hbWUsIG9uY2UpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ29uJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uKGV2ZW50TmFtZSwgaGFuZGxlcikgewogICAgICAgIGlmICghdGhpcy5fX2xpc3RlbmVyc1tldmVudE5hbWVdKSB0aGlzLl9fbGlzdGVuZXJzW2V2ZW50TmFtZV0gPSBbXTsKCiAgICAgICAgdGhpcy5fX2xpc3RlbmVyc1tldmVudE5hbWVdLnB1c2goaGFuZGxlcik7CgogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ29mZicsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBvZmYoZXZlbnROYW1lLCBoYW5kbGVyKSB7CiAgICAgICAgaWYgKGhhbmRsZXIpIHRoaXMuX19saXN0ZW5lcnNbZXZlbnROYW1lXSA9IHRoaXMuX19saXN0ZW5lcnNbZXZlbnROYW1lXS5maWx0ZXIoZnVuY3Rpb24gKGgpIHsKICAgICAgICAgIHJldHVybiBoICE9PSBoYW5kbGVyOwogICAgICAgIH0pO2Vsc2UgdGhpcy5fX2xpc3RlbmVyc1tldmVudE5hbWVdID0gW107CgogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIFRpbnlFbWl0dGVyOwogIH0oKTsKCiAgdmFyIHRpbnlFbWl0dGVyID0gVGlueUVtaXR0ZXI7CgogIHZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOwoKICB2YXIgX2dldCA9IGZ1bmN0aW9uIGdldChvYmplY3QsIHByb3BlcnR5LCByZWNlaXZlcikgeyBpZiAob2JqZWN0ID09PSBudWxsKSBvYmplY3QgPSBGdW5jdGlvbi5wcm90b3R5cGU7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgcmV0dXJuIGdldChwYXJlbnQsIHByb3BlcnR5LCByZWNlaXZlcik7IH0gfSBlbHNlIGlmICgidmFsdWUiIGluIGRlc2MpIHsgcmV0dXJuIGRlc2MudmFsdWU7IH0gZWxzZSB7IHZhciBnZXR0ZXIgPSBkZXNjLmdldDsgaWYgKGdldHRlciA9PT0gdW5kZWZpbmVkKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gcmV0dXJuIGdldHRlci5jYWxsKHJlY2VpdmVyKTsgfSB9OwoKICB2YXIgX3R5cGVvZiA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIgPyBmdW5jdGlvbiAob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9IDogZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OwoKICBmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9IGVsc2UgeyByZXR1cm4gQXJyYXkuZnJvbShhcnIpOyB9IH0KCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgogIGZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKCFzZWxmKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIGNhbGwgJiYgKHR5cGVvZiBjYWxsID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikgPyBjYWxsIDogc2VsZjsgfQoKICBmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAiICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfQoKICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKCgogIHZhciBNRVNTQUdFX1JFU1VMVCA9IDA7CiAgdmFyIE1FU1NBR0VfRVZFTlQgPSAxOwoKICB2YXIgUkVTVUxUX0VSUk9SID0gMDsKICB2YXIgUkVTVUxUX1NVQ0NFU1MgPSAxOwoKICB2YXIgREVGQVVMVF9IQU5ETEVSID0gJ21haW4nOwoKICB2YXIgaXNQcm9taXNlID0gZnVuY3Rpb24gaXNQcm9taXNlKG8pIHsKICAgIHJldHVybiAodHlwZW9mIG8gPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKG8pKSA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG8udGhlbiA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2Ygby5jYXRjaCA9PT0gJ2Z1bmN0aW9uJzsKICB9OwoKICBmdW5jdGlvbiBSZWdpc3RlclByb21pc2UoZm4pIHsKICAgIHZhciBoYW5kbGVycyA9IF9kZWZpbmVQcm9wZXJ0eSh7fSwgREVGQVVMVF9IQU5ETEVSLCBmbik7CiAgICB2YXIgc2VuZFBvc3RNZXNzYWdlID0gc2VsZi5wb3N0TWVzc2FnZS5iaW5kKHNlbGYpOwoKICAgIHZhciBzZXJ2ZXIgPSBuZXcgKGZ1bmN0aW9uIChfVGlueUVtaXR0ZXIpIHsKICAgICAgX2luaGVyaXRzKFdvcmtlclJlZ2lzdGVyLCBfVGlueUVtaXR0ZXIpOwoKICAgICAgZnVuY3Rpb24gV29ya2VyUmVnaXN0ZXIoKSB7CiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFdvcmtlclJlZ2lzdGVyKTsKCiAgICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIChXb3JrZXJSZWdpc3Rlci5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKFdvcmtlclJlZ2lzdGVyKSkuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICAgIH0KCiAgICAgIF9jcmVhdGVDbGFzcyhXb3JrZXJSZWdpc3RlciwgW3sKICAgICAgICBrZXk6ICdlbWl0JywKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZW1pdChldmVudE5hbWUpIHsKICAgICAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gQXJyYXkoX2xlbiA+IDEgPyBfbGVuIC0gMSA6IDApLCBfa2V5ID0gMTsgX2tleSA8IF9sZW47IF9rZXkrKykgewogICAgICAgICAgICBhcmdzW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTsKICAgICAgICAgIH0KCiAgICAgICAgICBzZW5kUG9zdE1lc3NhZ2UoeyBldmVudE5hbWU6IGV2ZW50TmFtZSwgYXJnczogYXJncyB9KTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogJ2VtaXRMb2NhbGx5JywKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZW1pdExvY2FsbHkoZXZlbnROYW1lKSB7CiAgICAgICAgICB2YXIgX2dldDI7CgogICAgICAgICAgZm9yICh2YXIgX2xlbjIgPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gQXJyYXkoX2xlbjIgPiAxID8gX2xlbjIgLSAxIDogMCksIF9rZXkyID0gMTsgX2tleTIgPCBfbGVuMjsgX2tleTIrKykgewogICAgICAgICAgICBhcmdzW19rZXkyIC0gMV0gPSBhcmd1bWVudHNbX2tleTJdOwogICAgICAgICAgfQoKICAgICAgICAgIChfZ2V0MiA9IF9nZXQoV29ya2VyUmVnaXN0ZXIucHJvdG90eXBlLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2YoV29ya2VyUmVnaXN0ZXIucHJvdG90eXBlKSwgJ2VtaXQnLCB0aGlzKSkuY2FsbC5hcHBseShfZ2V0MiwgW3RoaXMsIGV2ZW50TmFtZV0uY29uY2F0KGFyZ3MpKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICdvcGVyYXRpb24nLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBvcGVyYXRpb24obmFtZSwgaGFuZGxlcikgewogICAgICAgICAgaGFuZGxlcnNbbmFtZV0gPSBoYW5kbGVyOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gV29ya2VyUmVnaXN0ZXI7CiAgICB9KHRpbnlFbWl0dGVyKSkoKTsKCiAgICB2YXIgcnVuID0gZnVuY3Rpb24gcnVuKG1lc3NhZ2VJZCwgcGF5bG9hZCwgaGFuZGxlck5hbWUpIHsKCiAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbiBvblN1Y2Nlc3MocmVzdWx0KSB7CiAgICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQgaW5zdGFuY2VvZiBUcmFuc2ZlcmFibGVSZXNwb25zZSkgewogICAgICAgICAgc2VuZFJlc3VsdChtZXNzYWdlSWQsIFJFU1VMVF9TVUNDRVNTLCByZXN1bHQucGF5bG9hZCwgcmVzdWx0LnRyYW5zZmVyYWJsZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNlbmRSZXN1bHQobWVzc2FnZUlkLCBSRVNVTFRfU1VDQ0VTUywgcmVzdWx0KTsKICAgICAgICB9CiAgICAgIH07CgogICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uIG9uRXJyb3IoZSkgewogICAgICAgIHNlbmRSZXN1bHQobWVzc2FnZUlkLCBSRVNVTFRfRVJST1IsIHsKICAgICAgICAgIG1lc3NhZ2U6IGUubWVzc2FnZSwKICAgICAgICAgIHN0YWNrOiBlLnN0YWNrCiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICB0cnkgewogICAgICAgIHZhciByZXN1bHQgPSBydW5GbihtZXNzYWdlSWQsIHBheWxvYWQsIGhhbmRsZXJOYW1lKTsKICAgICAgICBpZiAoaXNQcm9taXNlKHJlc3VsdCkpIHsKICAgICAgICAgIHJlc3VsdC50aGVuKG9uU3VjY2VzcykuY2F0Y2gob25FcnJvcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG9uU3VjY2VzcyhyZXN1bHQpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIG9uRXJyb3IoZSk7CiAgICAgIH0KICAgIH07CgogICAgdmFyIHJ1bkZuID0gZnVuY3Rpb24gcnVuRm4obWVzc2FnZUlkLCBwYXlsb2FkLCBoYW5kbGVyTmFtZSkgewogICAgICB2YXIgaGFuZGxlciA9IGhhbmRsZXJzW2hhbmRsZXJOYW1lIHx8IERFRkFVTFRfSEFORExFUl07CiAgICAgIGlmICghaGFuZGxlcikgdGhyb3cgbmV3IEVycm9yKCdOb3QgZm91bmQgaGFuZGxlciBmb3IgdGhpcyByZXF1ZXN0Jyk7CgogICAgICByZXR1cm4gaGFuZGxlcihwYXlsb2FkLCBzZW5kRXZlbnQuYmluZChudWxsLCBtZXNzYWdlSWQpKTsKICAgIH07CgogICAgdmFyIHNlbmRSZXN1bHQgPSBmdW5jdGlvbiBzZW5kUmVzdWx0KG1lc3NhZ2VJZCwgc3VjY2VzcywgcGF5bG9hZCkgewogICAgICB2YXIgdHJhbnNmZXJhYmxlID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiBbXTsKCiAgICAgIHNlbmRQb3N0TWVzc2FnZShbTUVTU0FHRV9SRVNVTFQsIG1lc3NhZ2VJZCwgc3VjY2VzcywgcGF5bG9hZF0sIHRyYW5zZmVyYWJsZSk7CiAgICB9OwoKICAgIHZhciBzZW5kRXZlbnQgPSBmdW5jdGlvbiBzZW5kRXZlbnQobWVzc2FnZUlkLCBldmVudE5hbWUsIHBheWxvYWQpIHsKICAgICAgaWYgKCFldmVudE5hbWUpIHRocm93IG5ldyBFcnJvcignZXZlbnROYW1lIGlzIHJlcXVpcmVkJyk7CgogICAgICBpZiAodHlwZW9mIGV2ZW50TmFtZSAhPT0gJ3N0cmluZycpIHRocm93IG5ldyBFcnJvcignZXZlbnROYW1lIHNob3VsZCBiZSBzdHJpbmcnKTsKCiAgICAgIHNlbmRQb3N0TWVzc2FnZShbTUVTU0FHRV9FVkVOVCwgbWVzc2FnZUlkLCBldmVudE5hbWUsIHBheWxvYWRdKTsKICAgIH07CgogICAgc2VsZi5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZnVuY3Rpb24gKF9yZWYpIHsKICAgICAgdmFyIGRhdGEgPSBfcmVmLmRhdGE7CgogICAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSkgewogICAgICAgIHJ1bi5hcHBseSh1bmRlZmluZWQsIF90b0NvbnN1bWFibGVBcnJheShkYXRhKSk7CiAgICAgIH0gZWxzZSBpZiAoZGF0YSAmJiBkYXRhLmV2ZW50TmFtZSkgewogICAgICAgIHNlcnZlci5lbWl0TG9jYWxseS5hcHBseShzZXJ2ZXIsIFtkYXRhLmV2ZW50TmFtZV0uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShkYXRhLmFyZ3MpKSk7CiAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBzZXJ2ZXI7CiAgfQoKICB2YXIgVHJhbnNmZXJhYmxlUmVzcG9uc2UgPSBmdW5jdGlvbiBUcmFuc2ZlcmFibGVSZXNwb25zZShwYXlsb2FkLCB0cmFuc2ZlcmFibGUpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBUcmFuc2ZlcmFibGVSZXNwb25zZSk7CgogICAgdGhpcy5wYXlsb2FkID0gcGF5bG9hZDsKICAgIHRoaXMudHJhbnNmZXJhYmxlID0gdHJhbnNmZXJhYmxlOwogIH07CgogIHZhciByZWdpc3RlciA9IFJlZ2lzdGVyUHJvbWlzZTsKICB2YXIgVHJhbnNmZXJhYmxlUmVzcG9uc2VfMSA9IFRyYW5zZmVyYWJsZVJlc3BvbnNlOwogIHJlZ2lzdGVyLlRyYW5zZmVyYWJsZVJlc3BvbnNlID0gVHJhbnNmZXJhYmxlUmVzcG9uc2VfMTsKCiAgdmFyIFNsaWNpbmdNb2RlID0gewogICAgTk9ORTogLTEsCiAgICBJOiAwLAogICAgSjogMSwKICAgIEs6IDIsCiAgICBYOiAzLAogICAgWTogNCwKICAgIFo6IDUKICB9OwoKICAvKioNCiAgICogQ29tbW9uIHV0aWxpdGllcw0KICAgKiBAbW9kdWxlIGdsTWF0cml4DQogICAqLwogIHZhciBBUlJBWV9UWVBFID0gdHlwZW9mIEZsb2F0MzJBcnJheSAhPT0gJ3VuZGVmaW5lZCcgPyBGbG9hdDMyQXJyYXkgOiBBcnJheTsKICBpZiAoIU1hdGguaHlwb3QpIE1hdGguaHlwb3QgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgeSA9IDAsCiAgICAgICAgaSA9IGFyZ3VtZW50cy5sZW5ndGg7CgogICAgd2hpbGUgKGktLSkgewogICAgICB5ICs9IGFyZ3VtZW50c1tpXSAqIGFyZ3VtZW50c1tpXTsKICAgIH0KCiAgICByZXR1cm4gTWF0aC5zcXJ0KHkpOwogIH07CgogIC8qKg0KICAgKiAzIERpbWVuc2lvbmFsIFZlY3Rvcg0KICAgKiBAbW9kdWxlIHZlYzMNCiAgICovCgogIC8qKg0KICAgKiBDcmVhdGVzIGEgbmV3LCBlbXB0eSB2ZWMzDQogICAqDQogICAqIEByZXR1cm5zIHt2ZWMzfSBhIG5ldyAzRCB2ZWN0b3INCiAgICovCgogIGZ1bmN0aW9uIGNyZWF0ZSgpIHsKICAgIHZhciBvdXQgPSBuZXcgQVJSQVlfVFlQRSgzKTsKCiAgICBpZiAoQVJSQVlfVFlQRSAhPSBGbG9hdDMyQXJyYXkpIHsKICAgICAgb3V0WzBdID0gMDsKICAgICAgb3V0WzFdID0gMDsKICAgICAgb3V0WzJdID0gMDsKICAgIH0KCiAgICByZXR1cm4gb3V0OwogIH0KICAvKioNCiAgICogU3VidHJhY3RzIHZlY3RvciBiIGZyb20gdmVjdG9yIGENCiAgICoNCiAgICogQHBhcmFtIHt2ZWMzfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3INCiAgICogQHBhcmFtIHtSZWFkb25seVZlYzN9IGEgdGhlIGZpcnN0IG9wZXJhbmQNCiAgICogQHBhcmFtIHtSZWFkb25seVZlYzN9IGIgdGhlIHNlY29uZCBvcGVyYW5kDQogICAqIEByZXR1cm5zIHt2ZWMzfSBvdXQNCiAgICovCgogIGZ1bmN0aW9uIHN1YnRyYWN0KG91dCwgYSwgYikgewogICAgb3V0WzBdID0gYVswXSAtIGJbMF07CiAgICBvdXRbMV0gPSBhWzFdIC0gYlsxXTsKICAgIG91dFsyXSA9IGFbMl0gLSBiWzJdOwogICAgcmV0dXJuIG91dDsKICB9CiAgLyoqDQogICAqIFNjYWxlcyBhIHZlYzMgYnkgYSBzY2FsYXIgbnVtYmVyDQogICAqDQogICAqIEBwYXJhbSB7dmVjM30gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yDQogICAqIEBwYXJhbSB7UmVhZG9ubHlWZWMzfSBhIHRoZSB2ZWN0b3IgdG8gc2NhbGUNCiAgICogQHBhcmFtIHtOdW1iZXJ9IGIgYW1vdW50IHRvIHNjYWxlIHRoZSB2ZWN0b3IgYnkNCiAgICogQHJldHVybnMge3ZlYzN9IG91dA0KICAgKi8KCiAgZnVuY3Rpb24gc2NhbGUob3V0LCBhLCBiKSB7CiAgICBvdXRbMF0gPSBhWzBdICogYjsKICAgIG91dFsxXSA9IGFbMV0gKiBiOwogICAgb3V0WzJdID0gYVsyXSAqIGI7CiAgICByZXR1cm4gb3V0OwogIH0KICAvKioNCiAgICogQWRkcyB0d28gdmVjMydzIGFmdGVyIHNjYWxpbmcgdGhlIHNlY29uZCBvcGVyYW5kIGJ5IGEgc2NhbGFyIHZhbHVlDQogICAqDQogICAqIEBwYXJhbSB7dmVjM30gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yDQogICAqIEBwYXJhbSB7UmVhZG9ubHlWZWMzfSBhIHRoZSBmaXJzdCBvcGVyYW5kDQogICAqIEBwYXJhbSB7UmVhZG9ubHlWZWMzfSBiIHRoZSBzZWNvbmQgb3BlcmFuZA0KICAgKiBAcGFyYW0ge051bWJlcn0gc2NhbGUgdGhlIGFtb3VudCB0byBzY2FsZSBiIGJ5IGJlZm9yZSBhZGRpbmcNCiAgICogQHJldHVybnMge3ZlYzN9IG91dA0KICAgKi8KCiAgZnVuY3Rpb24gc2NhbGVBbmRBZGQob3V0LCBhLCBiLCBzY2FsZSkgewogICAgb3V0WzBdID0gYVswXSArIGJbMF0gKiBzY2FsZTsKICAgIG91dFsxXSA9IGFbMV0gKyBiWzFdICogc2NhbGU7CiAgICBvdXRbMl0gPSBhWzJdICsgYlsyXSAqIHNjYWxlOwogICAgcmV0dXJuIG91dDsKICB9CiAgLyoqDQogICAqIFBlcmZvcm0gc29tZSBvcGVyYXRpb24gb3ZlciBhbiBhcnJheSBvZiB2ZWMzcy4NCiAgICoNCiAgICogQHBhcmFtIHtBcnJheX0gYSB0aGUgYXJyYXkgb2YgdmVjdG9ycyB0byBpdGVyYXRlIG92ZXINCiAgICogQHBhcmFtIHtOdW1iZXJ9IHN0cmlkZSBOdW1iZXIgb2YgZWxlbWVudHMgYmV0d2VlbiB0aGUgc3RhcnQgb2YgZWFjaCB2ZWMzLiBJZiAwIGFzc3VtZXMgdGlnaHRseSBwYWNrZWQNCiAgICogQHBhcmFtIHtOdW1iZXJ9IG9mZnNldCBOdW1iZXIgb2YgZWxlbWVudHMgdG8gc2tpcCBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBhcnJheQ0KICAgKiBAcGFyYW0ge051bWJlcn0gY291bnQgTnVtYmVyIG9mIHZlYzNzIHRvIGl0ZXJhdGUgb3Zlci4gSWYgMCBpdGVyYXRlcyBvdmVyIGVudGlyZSBhcnJheQ0KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBGdW5jdGlvbiB0byBjYWxsIGZvciBlYWNoIHZlY3RvciBpbiB0aGUgYXJyYXkNCiAgICogQHBhcmFtIHtPYmplY3R9IFthcmddIGFkZGl0aW9uYWwgYXJndW1lbnQgdG8gcGFzcyB0byBmbg0KICAgKiBAcmV0dXJucyB7QXJyYXl9IGENCiAgICogQGZ1bmN0aW9uDQogICAqLwoKICAoZnVuY3Rpb24gKCkgewogICAgdmFyIHZlYyA9IGNyZWF0ZSgpOwogICAgcmV0dXJuIGZ1bmN0aW9uIChhLCBzdHJpZGUsIG9mZnNldCwgY291bnQsIGZuLCBhcmcpIHsKICAgICAgdmFyIGksIGw7CgogICAgICBpZiAoIXN0cmlkZSkgewogICAgICAgIHN0cmlkZSA9IDM7CiAgICAgIH0KCiAgICAgIGlmICghb2Zmc2V0KSB7CiAgICAgICAgb2Zmc2V0ID0gMDsKICAgICAgfQoKICAgICAgaWYgKGNvdW50KSB7CiAgICAgICAgbCA9IE1hdGgubWluKGNvdW50ICogc3RyaWRlICsgb2Zmc2V0LCBhLmxlbmd0aCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbCA9IGEubGVuZ3RoOwogICAgICB9CgogICAgICBmb3IgKGkgPSBvZmZzZXQ7IGkgPCBsOyBpICs9IHN0cmlkZSkgewogICAgICAgIHZlY1swXSA9IGFbaV07CiAgICAgICAgdmVjWzFdID0gYVtpICsgMV07CiAgICAgICAgdmVjWzJdID0gYVtpICsgMl07CiAgICAgICAgZm4odmVjLCB2ZWMsIGFyZyk7CiAgICAgICAgYVtpXSA9IHZlY1swXTsKICAgICAgICBhW2kgKyAxXSA9IHZlY1sxXTsKICAgICAgICBhW2kgKyAyXSA9IHZlY1syXTsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9OwogIH0pKCk7CgogIHZhciBnbG9iYWxzID0gewogICAgLy8gc2luZ2xlLWNvbXBvbmVudCBsYWJlbG1hcAogICAgYnVmZmVyOiBudWxsLAogICAgZGltZW5zaW9uczogWzAsIDAsIDBdLAogICAgcHJldlBvaW50OiBudWxsLAogICAgc2xpY2luZ01vZGU6IG51bGwgLy8gMkQgb3IgM0QgcGFpbnRpbmcKCiAgfTsgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgZnVuY3Rpb24gaGFuZGxlUGFpbnRSZWN0YW5nbGUoX3JlZikgewogICAgdmFyIHBvaW50MSA9IF9yZWYucG9pbnQxLAogICAgICAgIHBvaW50MiA9IF9yZWYucG9pbnQyOwoKICAgIHZhciBfcG9pbnQgPSBfc2xpY2VkVG9BcnJheV9fZGVmYXVsdFsnZGVmYXVsdCddKHBvaW50MSwgMyksCiAgICAgICAgeDEgPSBfcG9pbnRbMF0sCiAgICAgICAgeTEgPSBfcG9pbnRbMV0sCiAgICAgICAgejEgPSBfcG9pbnRbMl07CgogICAgdmFyIF9wb2ludDIgPSBfc2xpY2VkVG9BcnJheV9fZGVmYXVsdFsnZGVmYXVsdCddKHBvaW50MiwgMyksCiAgICAgICAgeDIgPSBfcG9pbnQyWzBdLAogICAgICAgIHkyID0gX3BvaW50MlsxXSwKICAgICAgICB6MiA9IF9wb2ludDJbMl07CgogICAgdmFyIHhzdGFydCA9IE1hdGgubWF4KE1hdGgubWluKHgxLCB4MiksIDApOwogICAgdmFyIHhlbmQgPSBNYXRoLm1pbihNYXRoLm1heCh4MSwgeDIpLCBnbG9iYWxzLmRpbWVuc2lvbnNbMF0gLSAxKTsKCiAgICBpZiAoeHN0YXJ0IDw9IHhlbmQpIHsKICAgICAgdmFyIHlzdGFydCA9IE1hdGgubWF4KE1hdGgubWluKHkxLCB5MiksIDApOwogICAgICB2YXIgeWVuZCA9IE1hdGgubWluKE1hdGgubWF4KHkxLCB5MiksIGdsb2JhbHMuZGltZW5zaW9uc1sxXSAtIDEpOwogICAgICB2YXIgenN0YXJ0ID0gTWF0aC5tYXgoTWF0aC5taW4oejEsIHoyKSwgMCk7CiAgICAgIHZhciB6ZW5kID0gTWF0aC5taW4oTWF0aC5tYXgoejEsIHoyKSwgZ2xvYmFscy5kaW1lbnNpb25zWzJdIC0gMSk7CiAgICAgIHZhciBqU3RyaWRlID0gZ2xvYmFscy5kaW1lbnNpb25zWzBdOwogICAgICB2YXIga1N0cmlkZSA9IGdsb2JhbHMuZGltZW5zaW9uc1swXSAqIGdsb2JhbHMuZGltZW5zaW9uc1sxXTsKCiAgICAgIGZvciAodmFyIGsgPSB6c3RhcnQ7IGsgPD0gemVuZDsgaysrKSB7CiAgICAgICAgZm9yICh2YXIgaiA9IHlzdGFydDsgaiA8PSB5ZW5kOyBqKyspIHsKICAgICAgICAgIHZhciBpbmRleCA9IGogKiBqU3RyaWRlICsgayAqIGtTdHJpZGU7CiAgICAgICAgICBnbG9iYWxzLmJ1ZmZlci5maWxsKDEsIGluZGV4ICsgeHN0YXJ0LCBpbmRleCArIHhlbmQgKyAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9IC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgLy8gY2VudGVyIGFuZCBzY2FsZTMgYXJlIGluIElKSyBjb29yZGluYXRlcwoKCiAgZnVuY3Rpb24gaGFuZGxlUGFpbnRFbGxpcHNlKF9yZWYyKSB7CiAgICB2YXIgY2VudGVyID0gX3JlZjIuY2VudGVyLAogICAgICAgIHNjYWxlMyA9IF9yZWYyLnNjYWxlMzsKCiAgICB2YXIgcmFkaXVzMyA9IF90b0NvbnN1bWFibGVBcnJheV9fZGVmYXVsdFsnZGVmYXVsdCddKHNjYWxlMyk7CgogICAgdmFyIGluZGV4Q2VudGVyID0gY2VudGVyLm1hcChmdW5jdGlvbiAodmFsKSB7CiAgICAgIHJldHVybiBNYXRoLnJvdW5kKHZhbCk7CiAgICB9KTsKCiAgICBpZiAoZ2xvYmFscy5zbGljaW5nTW9kZSAhPSBudWxsICYmIGdsb2JhbHMuc2xpY2luZ01vZGUgIT09IFNsaWNpbmdNb2RlLk5PTkUpIHsKICAgICAgdmFyIHNsaWNlQXhpcyA9IGdsb2JhbHMuc2xpY2luZ01vZGUgJSAzOwogICAgICByYWRpdXMzW3NsaWNlQXhpc10gPSAwOwogICAgfQoKICAgIHZhciB5U3RyaWRlID0gZ2xvYmFscy5kaW1lbnNpb25zWzBdOwogICAgdmFyIHpTdHJpZGUgPSBnbG9iYWxzLmRpbWVuc2lvbnNbMF0gKiBnbG9iYWxzLmRpbWVuc2lvbnNbMV07CiAgICB2YXIgem1pbiA9IE1hdGgucm91bmQoTWF0aC5tYXgoaW5kZXhDZW50ZXJbMl0gLSByYWRpdXMzWzJdLCAwKSk7CiAgICB2YXIgem1heCA9IE1hdGgucm91bmQoTWF0aC5taW4oaW5kZXhDZW50ZXJbMl0gKyByYWRpdXMzWzJdLCBnbG9iYWxzLmRpbWVuc2lvbnNbMl0gLSAxKSk7CgogICAgZm9yICh2YXIgeiA9IHptaW47IHogPD0gem1heDsgeisrKSB7CiAgICAgIHZhciBkeiA9IChpbmRleENlbnRlclsyXSAtIHopIC8gcmFkaXVzM1syXTsKICAgICAgdmFyIGF5ID0gcmFkaXVzM1sxXSAqIE1hdGguc3FydCgxIC0gZHogKiBkeik7CiAgICAgIHZhciB5bWluID0gTWF0aC5yb3VuZChNYXRoLm1heChpbmRleENlbnRlclsxXSAtIGF5LCAwKSk7CiAgICAgIHZhciB5bWF4ID0gTWF0aC5yb3VuZChNYXRoLm1pbihpbmRleENlbnRlclsxXSArIGF5LCBnbG9iYWxzLmRpbWVuc2lvbnNbMV0gLSAxKSk7CgogICAgICBmb3IgKHZhciB5ID0geW1pbjsgeSA8PSB5bWF4OyB5KyspIHsKICAgICAgICB2YXIgZHkgPSAoaW5kZXhDZW50ZXJbMV0gLSB5KSAvIHJhZGl1czNbMV07CiAgICAgICAgdmFyIGF4ID0gcmFkaXVzM1swXSAqIE1hdGguc3FydCgxIC0gZHkgKiBkeSAtIGR6ICogZHopOwogICAgICAgIHZhciB4bWluID0gTWF0aC5yb3VuZChNYXRoLm1heChpbmRleENlbnRlclswXSAtIGF4LCAwKSk7CiAgICAgICAgdmFyIHhtYXggPSBNYXRoLnJvdW5kKE1hdGgubWluKGluZGV4Q2VudGVyWzBdICsgYXgsIGdsb2JhbHMuZGltZW5zaW9uc1swXSAtIDEpKTsKCiAgICAgICAgaWYgKHhtaW4gPD0geG1heCkgewogICAgICAgICAgdmFyIGluZGV4ID0geSAqIHlTdHJpZGUgKyB6ICogelN0cmlkZTsKICAgICAgICAgIGdsb2JhbHMuYnVmZmVyLmZpbGwoMSwgaW5kZXggKyB4bWluLCBpbmRleCArIHhtYXggKyAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9IC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoKICBmdW5jdGlvbiBoYW5kbGVQYWludChfcmVmMykgewogICAgdmFyIHBvaW50ID0gX3JlZjMucG9pbnQsCiAgICAgICAgcmFkaXVzID0gX3JlZjMucmFkaXVzOwoKICAgIGlmICghZ2xvYmFscy5wcmV2UG9pbnQpIHsKICAgICAgZ2xvYmFscy5wcmV2UG9pbnQgPSBwb2ludDsKICAgIH0gLy8gRERBIHBhcmFtcwoKCiAgICB2YXIgZGVsdGEgPSBbcG9pbnRbMF0gLSBnbG9iYWxzLnByZXZQb2ludFswXSwgcG9pbnRbMV0gLSBnbG9iYWxzLnByZXZQb2ludFsxXSwgcG9pbnRbMl0gLSBnbG9iYWxzLnByZXZQb2ludFsyXV07CiAgICB2YXIgaW5jID0gWzEsIDEsIDFdOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgIGlmIChkZWx0YVtpXSA8IDApIHsKICAgICAgICBkZWx0YVtpXSA9IC1kZWx0YVtpXTsKICAgICAgICBpbmNbaV0gPSAtMTsKICAgICAgfQogICAgfQoKICAgIHZhciBzdGVwID0gTWF0aC5tYXguYXBwbHkoTWF0aCwgZGVsdGEpOyAvLyBEREEKCiAgICB2YXIgdGhyZXNoID0gW3N0ZXAsIHN0ZXAsIHN0ZXBdOwoKICAgIHZhciBwdCA9IF90b0NvbnN1bWFibGVBcnJheV9fZGVmYXVsdFsnZGVmYXVsdCddKGdsb2JhbHMucHJldlBvaW50KTsKCiAgICBmb3IgKHZhciBzID0gMDsgcyA8PSBzdGVwOyBzKyspIHsKICAgICAgaGFuZGxlUGFpbnRFbGxpcHNlKHsKICAgICAgICBjZW50ZXI6IHB0LAogICAgICAgIHNjYWxlMzogcmFkaXVzCiAgICAgIH0pOwoKICAgICAgZm9yICh2YXIgaWkgPSAwOyBpaSA8IDM7IGlpKyspIHsKICAgICAgICB0aHJlc2hbaWldIC09IGRlbHRhW2lpXTsKCiAgICAgICAgaWYgKHRocmVzaFtpaV0gPD0gMCkgewogICAgICAgICAgdGhyZXNoW2lpXSArPSBzdGVwOwogICAgICAgICAgcHRbaWldICs9IGluY1tpaV07CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgZ2xvYmFscy5wcmV2UG9pbnQgPSBwb2ludDsKICB9IC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoKICBmdW5jdGlvbiBoYW5kbGVQYWludFRyaWFuZ2xlcyhfcmVmNCkgewogICAgdmFyIHRyaWFuZ2xlTGlzdCA9IF9yZWY0LnRyaWFuZ2xlTGlzdDsKICAgIC8vIGRlYnVnZ2VyOwogICAgdmFyIHRyaWFuZ2xlQ291bnQgPSBNYXRoLmZsb29yKHRyaWFuZ2xlTGlzdC5sZW5ndGggLyA5KTsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRyaWFuZ2xlQ291bnQ7IGkrKykgewogICAgICB2YXIgcG9pbnQwID0gdHJpYW5nbGVMaXN0LnN1YmFycmF5KDkgKiBpICsgMCwgOSAqIGkgKyAzKTsKICAgICAgdmFyIHBvaW50MSA9IHRyaWFuZ2xlTGlzdC5zdWJhcnJheSg5ICogaSArIDMsIDkgKiBpICsgNik7CiAgICAgIHZhciBwb2ludDIgPSB0cmlhbmdsZUxpc3Quc3ViYXJyYXkoOSAqIGkgKyA2LCA5ICogaSArIDkpOwogICAgICB2YXIgdjEgPSBbMCwgMCwgMF07CiAgICAgIHZhciB2MiA9IFswLCAwLCAwXTsKICAgICAgc3VidHJhY3QodjEsIHBvaW50MSwgcG9pbnQwKTsKICAgICAgc3VidHJhY3QodjIsIHBvaW50MiwgcG9pbnQwKTsKICAgICAgdmFyIHN0ZXAxID0gWzAsIDAsIDBdOwogICAgICB2YXIgbnVtU3RlcDEgPSAyICogTWF0aC5tYXgoTWF0aC5hYnModjFbMF0pLCBNYXRoLmFicyh2MVsxXSksIE1hdGguYWJzKHYxWzJdKSk7CiAgICAgIHNjYWxlKHN0ZXAxLCB2MSwgMSAvIG51bVN0ZXAxKTsKICAgICAgdmFyIHN0ZXAyID0gWzAsIDAsIDBdOwogICAgICB2YXIgbnVtU3RlcDIgPSAyICogTWF0aC5tYXgoTWF0aC5hYnModjJbMF0pLCBNYXRoLmFicyh2MlsxXSksIE1hdGguYWJzKHYyWzJdKSk7CiAgICAgIHNjYWxlKHN0ZXAyLCB2MiwgMSAvIG51bVN0ZXAyKTsKICAgICAgdmFyIGpTdHJpZGUgPSBnbG9iYWxzLmRpbWVuc2lvbnNbMF07CiAgICAgIHZhciBrU3RyaWRlID0gZ2xvYmFscy5kaW1lbnNpb25zWzBdICogZ2xvYmFscy5kaW1lbnNpb25zWzFdOwoKICAgICAgZm9yICh2YXIgdSA9IDA7IHUgPD0gbnVtU3RlcDEgKyAxOyB1KyspIHsKICAgICAgICB2YXIgbWF4ViA9IG51bVN0ZXAyIC0gdSAqIChudW1TdGVwMiAvIG51bVN0ZXAxKTsKCiAgICAgICAgZm9yICh2YXIgdiA9IDA7IHYgPD0gbWF4ViArIDE7IHYrKykgewogICAgICAgICAgdmFyIHBvaW50ID0gX3RvQ29uc3VtYWJsZUFycmF5X19kZWZhdWx0WydkZWZhdWx0J10ocG9pbnQwKTsKCiAgICAgICAgICBzY2FsZUFuZEFkZChwb2ludCwgcG9pbnQsIHN0ZXAxLCB1KTsKICAgICAgICAgIHNjYWxlQW5kQWRkKHBvaW50LCBwb2ludCwgc3RlcDIsIHYpOwogICAgICAgICAgcG9pbnRbMF0gPSBNYXRoLnJvdW5kKHBvaW50WzBdKTsKICAgICAgICAgIHBvaW50WzFdID0gTWF0aC5yb3VuZChwb2ludFsxXSk7CiAgICAgICAgICBwb2ludFsyXSA9IE1hdGgucm91bmQocG9pbnRbMl0pOwoKICAgICAgICAgIGlmIChwb2ludFswXSA+PSAwICYmIHBvaW50WzBdIDwgZ2xvYmFscy5kaW1lbnNpb25zWzBdICYmIHBvaW50WzFdID49IDAgJiYgcG9pbnRbMV0gPCBnbG9iYWxzLmRpbWVuc2lvbnNbMV0gJiYgcG9pbnRbMl0gPj0gMCAmJiBwb2ludFsyXSA8IGdsb2JhbHMuZGltZW5zaW9uc1syXSkgewogICAgICAgICAgICBnbG9iYWxzLmJ1ZmZlcltwb2ludFswXSArIGpTdHJpZGUgKiBwb2ludFsxXSArIGtTdHJpZGUgKiBwb2ludFsyXV0gPSAxOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0gLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgogIHJlZ2lzdGVyKCkub3BlcmF0aW9uKCdzdGFydCcsIGZ1bmN0aW9uIChfcmVmNSkgewogICAgdmFyIGJ1ZmZlclR5cGUgPSBfcmVmNS5idWZmZXJUeXBlLAogICAgICAgIGRpbWVuc2lvbnMgPSBfcmVmNS5kaW1lbnNpb25zLAogICAgICAgIHNsaWNpbmdNb2RlID0gX3JlZjUuc2xpY2luZ01vZGU7CgogICAgaWYgKCFnbG9iYWxzLmJ1ZmZlcikgewogICAgICB2YXIgYnVmZmVyU2l6ZSA9IGRpbWVuc2lvbnNbMF0gKiBkaW1lbnNpb25zWzFdICogZGltZW5zaW9uc1syXTsKICAgICAgLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lICovCgogICAgICBnbG9iYWxzLmJ1ZmZlciA9IG5ldyBzZWxmW2J1ZmZlclR5cGVdKGJ1ZmZlclNpemUpOwogICAgICBnbG9iYWxzLmRpbWVuc2lvbnMgPSBkaW1lbnNpb25zOwogICAgICBnbG9iYWxzLnByZXZQb2ludCA9IG51bGw7CiAgICAgIGdsb2JhbHMuc2xpY2luZ01vZGUgPSBzbGljaW5nTW9kZTsKICAgIH0KICB9KS5vcGVyYXRpb24oJ3BhaW50JywgaGFuZGxlUGFpbnQpLm9wZXJhdGlvbigncGFpbnRSZWN0YW5nbGUnLCBoYW5kbGVQYWludFJlY3RhbmdsZSkub3BlcmF0aW9uKCdwYWludEVsbGlwc2UnLCBoYW5kbGVQYWludEVsbGlwc2UpLm9wZXJhdGlvbigncGFpbnRUcmlhbmdsZXMnLCBoYW5kbGVQYWludFRyaWFuZ2xlcykub3BlcmF0aW9uKCdlbmQnLCBmdW5jdGlvbiAoKSB7CiAgICB2YXIgcmVzcG9uc2UgPSBuZXcgcmVnaXN0ZXIuVHJhbnNmZXJhYmxlUmVzcG9uc2UoZ2xvYmFscy5idWZmZXIuYnVmZmVyLCBbZ2xvYmFscy5idWZmZXIuYnVmZmVyXSk7CiAgICBnbG9iYWxzLmJ1ZmZlciA9IG51bGw7CiAgICByZXR1cm4gcmVzcG9uc2U7CiAgfSk7Cgp9KF90b0NvbnN1bWFibGVBcnJheSQxLCBfc2xpY2VkVG9BcnJheSkpOwoK', null, false);
/* eslint-enable */

export { WorkerFactory as W };
